<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- begin::GXON Meta Basic -->
    <meta charset="utf-8" />
    <title>Fusion</title>
    <link rel="icon" type="image/png" href="assets/images/logo.jpeg" />
    <!-- end::GXON Website Page Title -->

    <!-- begin::GXON Mobile Specific -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- end::GXON Mobile Specific -->

    <!-- begin::GXON Favicon Tags -->

    <!-- end::GXON Favicon Tags -->

    <!-- begin::GXON Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
      rel="stylesheet"
    />
    <!-- end::GXON Google Fonts -->

    <!-- begin::GXON Required Stylesheet -->
    <link rel="stylesheet" href="assets/libs/flaticon/css/all/all.css" />
    <link rel="stylesheet" href="assets/libs/lucide/lucide.css" />
    <link rel="stylesheet" href="assets/libs/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="assets/libs/simplebar/simplebar.css" />
    <link rel="stylesheet" href="assets/libs/node-waves/waves.css" />
    <link
      rel="stylesheet"
      href="assets/libs/bootstrap-select/css/bootstrap-select.min.css"
    />
    <!-- end::GXON Required Stylesheet -->
    <!-- begin::GXON CSS Stylesheet -->
    <link rel="stylesheet" href="assets/libs/flatpickr/flatpickr.min.css" />
    <link rel="stylesheet" href="assets/libs/datatables/datatables.min.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <!-- end::GXON CSS Stylesheet -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- begin::GXON Googletagmanager -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XWVQM68HHQ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-XWVQM68HHQ", {
        cookie_flags: "SameSite=None;Secure",
        send_page_view: true,
      });
    </script>
    <!-- end::GXON Googletagmanager -->
    <style>
      .container {
        max-width: px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e5e5e5;
      }

      .title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .period {
        font-size: 14px;
        color: #666;
      }

      .chart-container {
        margin-bottom: 30px;
        height: 300px;
        position: relative;
        border: 1px solid #f0f0f0;
        background: #fafafa;
      }

      .chart-svg {
        width: 100%;
        height: 100%;
      }

      .metrics {
        display: flex;
        justify-content: space-between;
        gap: 20px;
      }

      .metric {
        flex: 1;
        text-align: left;
      }

      .metric-header {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }

      .metric-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .metric-dot.ptsp {
        background-color: #e85d75;
      }

      .metric-dot.pssp {
        background-color: #4ecdc4;
      }

      .metric-label {
        font-size: 13px;
        color: #666;
      }

      .metric-value {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin: 2px 0;
      }

      .avg-label {
        font-size: 13px;
        color: #666;
        margin-bottom: 5px;
      }

      .avg-value {
        font-size: 18px;
        font-weight: 600;
        color: #333;
      }

      .axis-label {
        font-size: 11px;
        fill: #666;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      .grid-line {
        stroke: #f0f0f0;
        stroke-width: 1;
      }

      .chart-line {
        fill: none;
        stroke-width: 3;
      }

      .ptsp-line {
        stroke: #e85d75;
      }

      .pssp-line {
        stroke: #4ecdc4;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .metrics {
          flex-direction: column;
          gap: 15px;
        }

        .chart-container {
          height: 250px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .chart-container {
          height: 200px;
        }

        .metric-value,
        .avg-value {
          font-size: 16px;
        }
      }
      /* last chart */

      .chart-card {
        background: #fff;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }
      .chart-container {
        position: relative;
        height: 350px;
      }
      .chart-title {
        font-weight: 600;
        font-size: 1.1rem;
        color: #1a1a3d;
      }
    </style>
  </head>

  <body>
    <div class="page-layout">
      <!-- begin::GXON Page Header -->
      <header class="app-header">
        <div class="app-header-inner" id="header"></div>
      </header>

    <!-- begin::GXON Sidebar Menu -->
      <div id="sidebsr"></div>
      <!-- end::GXON Sidebar Menu -->

      <!-- begin::GXON Sidebar right -->
      <div class="app-sidebar-end"></div>
      <!-- end::GXON Sidebar right -->

      
    <main class="app-wrapper">
      <div class="container">
        <div
          class="app-page-head d-flex align-items-center justify-content-between"
        >
          <div class="clearfix">
            <h3>Transactions Hub</span></h3>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"></li>
              </ol>
            </nav>
          </div>
          <div
            class="d-flex justify-content-end align-items-center gap-2"
          ></div>
        </div>
        <div class="container">

  <!-- Search Filter -->
  <div class="row mb-3">
    <div class="col-md-6">
      <input type="text" id="searchInput" class="form-control" placeholder="Search transactions...">
    </div>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="">
        <tr>
          <th>PTSP / PSSP</th>
          <th>Merchant Number</th>
          <th>Type</th>
          <th>Payment Ref</th>
          <th>Issuing Bank</th>
          <th>Amount</th>
          <th>Commission</th>
          <th>WHT</th>
          <th>Date / Time</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="10" class="text-center">Loading...</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav>
    <ul class="pagination" id="pagination"></ul>
  </nav>
</div>

<script>
  const API_URL = "https://arafatfootballacademy.com/fusion/backend/transactions";
  const tableBody = document.getElementById("tableBody");
  const searchInput = document.getElementById("searchInput");
  const pagination = document.getElementById("pagination");

  let transactions = [];
  let filteredData = [];
  let currentPage = 1;
  const rowsPerPage = 10;

  async function fetchTransactions() {
    try {
      const res = await fetch(API_URL);
      const json = await res.json();

      transactions = json?.data?.transactions || [];
      filteredData = [...transactions];
      currentPage = 1;
      renderTable();
      renderPagination();
    } catch (err) {
      tableBody.innerHTML = `<tr><td colspan="10" class="text-center text-danger">Error fetching data</td></tr>`;
      console.error("fetchTransactions error:", err);
    }
  }

  function renderTable() {
    const start = (currentPage - 1) * rowsPerPage;
    const end = start + rowsPerPage;
    const rows = filteredData.slice(start, end);

    if (!rows.length) {
      tableBody.innerHTML = `<tr><td colspan="10" class="text-center">No records found</td></tr>`;
      return;
    }

    tableBody.innerHTML = rows.map(row => {
      const provider = row.provider_name ?? "-";
      const merchant = row.marchant_number ?? "-";
      const paymentRef = row.payment_reference ?? "-";
      const amount = Number(row.amount) || 0;
      const status = row.status ?? "-";
      const created = row.created_at ? new Date(row.created_at).toLocaleString() : "-";
      const type = row.transaction_type ?? "-";
      const bank = row.issuing_bank ?? "-";
      const commission = row.commission ?? "-";
      const wht = row.wht ?? "-";

      return `
        <tr>
          <td>${provider}</td>
          <td>${merchant}</td>
          <td>${type}</td>
          <td>${paymentRef}</td>
          <td>${bank}</td>
          <td>â‚¦${amount.toLocaleString()}</td>
          <td>${commission}</td>
          <td>${wht}</td>
          <td>${created}</td>
          <td><span class="badge bg-${status === "success" ? "success" : "secondary"}">${status}</span></td>
        </tr>
      `;
    }).join("");
  }

  function renderPagination() {
    const pageCount = Math.ceil(filteredData.length / rowsPerPage) || 1;
    pagination.innerHTML = "";

    for (let i = 1; i <= pageCount; i++) {
      pagination.innerHTML += `
        <li class="page-item ${i === currentPage ? "active" : ""}">
          <a class="page-link" href="#" data-page="${i}">${i}</a>
        </li>
      `;
    }
  }

  // Pagination click
  pagination.addEventListener("click", (e) => {
    const link = e.target.closest("a[data-page]");
    if (!link) return;
    e.preventDefault();
    currentPage = Number(link.dataset.page);
    renderTable();
    renderPagination();
  });

  // Search filter
  searchInput.addEventListener("input", (e) => {
    const query = e.target.value.toLowerCase();
    filteredData = transactions.filter(row =>
      Object.values(row).some(val =>
        val && String(val).toLowerCase().includes(query)
      )
    );
    currentPage = 1;
    renderTable();
    renderPagination();
  });

  fetchTransactions();
</script>


        </div>
        </main>




    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="assets/js/header.js"></script>
    <script src="assets/libs/global/global.min.js"></script>
    <script src="assets/libs/chartjs/chart.js"></script>
    <script src="assets/libs/apexcharts/apexcharts.min.js"></script>
    <script src="assets/libs/datatables/datatables.min.js"></script>
    <script src="assets/libs/flatpickr/flatpickr.min.js"></script>
    <!-- <script src="assets/js/dashboard.js"></script> -->
    <script src="assets/js/appSettings.js"></script>
</div>
</body>
</html>