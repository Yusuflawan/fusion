<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Fusion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="assets/images/logo.jpeg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="assets/libs/flaticon/css/all/all.css" />
    <link rel="stylesheet" href="assets/libs/lucide/lucide.css" />
    <link rel="stylesheet" href="assets/libs/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="assets/libs/simplebar/simplebar.css" />
    <link rel="stylesheet" href="assets/libs/node-waves/waves.css" />
    <link
      rel="stylesheet"
      href="assets/libs/bootstrap-select/css/bootstrap-select.min.css"
    />
    <!-- end::GXON Required Stylesheet -->

    <!-- begin::GXON CSS Stylesheet -->
    <link rel="stylesheet" href="assets/libs/datatables/datatables.min.css" />
    <link rel="stylesheet" href="assets/libs/flatpickr/flatpickr.min.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <!-- end::GXON CSS Stylesheet -->

    <!-- begin::GXON Googletagmanager -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XWVQM68HHQ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-XWVQM68HHQ", {
        cookie_flags: "SameSite=None;Secure",
        send_page_view: true,
      });
    </script>
    <!-- end::GXON Googletagmanager -->
  </head>

  <body>
    <main>
      <div class="page-layout">
        <!-- begin::GXON Page Header -->
        <header class="app-header">
          <div class="app-header-inner" id="header"></div>
        </header>

        <div
          class="modal fade"
          id="searchResultsModal"
          tabindex="-1"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header py-1 px-3">
                <form
                  class="d-flex align-items-center position-relative w-100"
                  action="leave.html#"
                >
                  <button
                    type="button"
                    class="btn btn-sm border-0 position-absolute start-0 p-0 text-sm"
                  >
                    <i class="fi fi-rr-search"></i>
                  </button>
                  <input
                    type="text"
                    class="form-control form-control-lg ps-4 border-0 shadow-none"
                    id="searchInput"
                    placeholder="Search anything's"
                  />
                </form>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body pb-2" style="height: 300px" data-simplebar>
                <div id="recentlyResults">
                  <span
                    class="text-uppercase text-2xs fw-semibold text-muted d-block mb-2"
                    >Recently Searched:</span
                  >
                  <ul class="list-inline search-list">
                    <li>
                      <a class="search-item" href="index.html">
                        <i class="fi fi-rr-apps"></i> Dashboard
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="user.html">
                        <i class="fi fi-rr-comment"></i>User Management
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="roles.html">
                        <i class="fi fi-rr-calendar"></i>Roles & Access control
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="PTSP.html">
                        <i class="fi fi-rr-chart-pie-alt"></i> ptsp onboarding
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="data.html">
                        <i class="fi fi-rr-file"></i>data ingestion monitor
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="audit.html">
                        <i class="fi fi-rr-envelope"></i> audit log
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="transaction.html">
                        <i class="fi fi-rr-envelope"></i>Tax Transaction Config
                      </a>
                    </li>
                  </ul>
                </div>
                <div id="searchContainer"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- begin::GXON Sidebar Menu -->
        <div id="sidebsr"></div>
        <!-- end::GXON Sidebar Menu -->
      </div>

      <!-- begin::GXON Sidebar right -->
      <div class="app-sidebar-end"></div>
      <!-- end::GXON Sidebar right -->

      <div class="app-wrapper">
        <div class="container">
          <div class="app-page-head row align-items-center mb-4">
            <!-- Left Column: Title and Breadcrumb -->
            <div class="col-md-8">
              <h1 class="app-page-title">Audit Logs</h1>
            </div>

            <!-- Right Column: Button -->
            <div class="col-md-4 text-md-start mt-3 mt-md-0">
              <div class="d-flex justify-content-end">
                <!-- Export Button with Dropdown -->
                <!-- Export Button with Dropdown (Selective) -->
                <div class="btn-group">
                  <button
                    type="button"
                    class="btn btn-primary dropdown-toggle"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    id="exportDropdown"
                  >
                    <i class="fi fi-rr-download me-1"></i> Export
                  </button>
                  <ul
                    class="dropdown-menu dropdown-menu-end"
                    aria-labelledby="exportDropdown"
                  >
                    <li><a class="dropdown-item active" href="#">Excel</a></li>
                    <li><a class="dropdown-item" href="#">CSV</a></li>
                    <li><a class="dropdown-item" href="#">PDF</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-xxl-4 col-lg-4 col-sm-6">
              <div
                class="card card-action action-border-secondary p-1 position-relative"
              >
                <div class="card-body d-flex align-items-center p-4 gap-4">
                  <!-- Icon -->
                  <div
                    class="text-success d-flex align-items-center justify-content-center rounded-circle bg-light p-3"
                  >
                    <i class="fi fi-rr-user fs-2"></i>
                  </div>
                  <!-- Texts -->
                  <div class="clearfix ms-2">
                    <div class="mb-2">Total Activities</div>
                    <h3 class="mb-2 fw-bold" id="totalActivities"></h3>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xxl-4 col-lg-4 col-sm-6">
              <div
                class="card card-action action-border-success p-1 position-relative"
              >
                <div class="card-body d-flex gap-4 align-items-center p-4">
                  <!-- Icon -->
                  <div
                    class="text-success d-flex align-items-center justify-content-center rounded-circle bg-warning p-3"
                  >
                    <i class="fi fi-rr-user fs-2"></i>
                  </div>
                  <!-- Texts -->
                  <div class="clearfix ms-2">
                    <div class="mb-2">Security Alarts</div>
                    <h3 class="mb-2 fw-bold">1</h3>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xxl-4 col-lg-4 col-sm-6">
              <div
                class="card card-action action-border-info p-1 position-relative"
              >
                <div
                  class="card-body d-flex justify-content-between align-items-center p-4"
                >
                  <!-- Left side (icon + texts) -->
                  <div class="d-flex gap-4 align-items-center">
                    <!-- Icon -->
                    <div
                      class="text-danger d-flex align-items-center justify-content-center rounded-circle bg-light p-3"
                    >
                      <i class="fi fi-rr-cross-circle fs-2"></i>
                    </div>
                    <!-- Texts -->
                    <div class="clearfix">
                      <div class="mb-2">Failed Login</div>
                      <h3 class="mb-2 fw-bold">1</h3>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-12">
              <div
                class="card-header d-flex flex-wrap align-items-center border-0 pb-0"
              >
                <!-- Title -->
                <div>
                  <h6 class="card-title mb-0">Users Activity Logs</h6>
                  <small class="text-muted"
                    >Track all user actions and system interactions</small
                  >
                </div>

                <!-- Search + Filters aligned right -->
                <div class="d-flex gap-3 flex-wrap ms-auto align-items-center">
                  <!-- Search -->
                  <div id="dt_PageEmployeeLeave_Search" class="mb-0">
                    <div class="input-group">
                      <span class="input-group-text">
                        <i class="fi fi-rr-search"></i>
                      </span>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Search..."
                        aria-label="Search"
                      />
                    </div>
                  </div>

                  <!-- All Actions Dropdown -->
                  <div class="dropdown">
                    <button
                      class="btn btn-sm btn-outline-light btn-shadow waves-effect dropdown-toggle"
                      type="button"
                      id="actionsDropdown"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      All Actions
                    </button>
                    <ul
                      class="dropdown-menu dropdown-menu-end"
                      aria-labelledby="actionsDropdown"
                    >
                      <li><a class="dropdown-item" href="#">Login</a></li>
                      <li><a class="dropdown-item" href="#">Upload File</a></li>
                      <li><a class="dropdown-item" href="#">API Sync</a></li>
                      <li>
                        <hr class="dropdown-divider" />
                      </li>
                      <li>
                        <a class="dropdown-item text-danger" href="#">Delete</a>
                      </li>
                    </ul>
                  </div>

                  <!-- All Status Dropdown -->
                  <select
                    class="selectpicker"
                    data-style="btn-sm btn-outline-light btn-shadow waves-effect"
                  >
                    <option value="all">All Status</option>
                    <option value="success">Success</option>
                    <option value="failed">Failed</option>
                  </select>
                </div>
              </div>

              <div class="card-body p-2">
                <table
                  class="table display table-row-rounded data-row-checkbox"
                >
                  <thead class="table-light">
                    <tr>
                      <th class="pe-0">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            data-row-checkbox
                            type="checkbox"
                          />
                        </div>
                      </th>
                      <th class="minw-200px">Timestamp</th>
                      <th class="minw-200px">Email Address</th>
                      <th class="minw-150px">Action</th>
                      <th class="minw-150px">Role</th>
                      <th class="minw-150px">Details</th>
                      <th class="minw-100px text-end">Status</th>
                    </tr>
                  </thead>
                  <tbody id="logsTableBody"></tbody>
                </table>

                <script>
                  document.addEventListener("DOMContentLoaded", () => {
                    const totalActivities =
                      document.getElementById("totalActivities");
                    const tableBody = document.getElementById("logsTableBody");

                    const endpoint =
                      "https://arafatfootballacademy.com/fusion/backend/audit-logs";

                    fetch(endpoint)
                      .then((res) => res.json())
                      .then((response) => {
                        if (
                          response.status === "success" &&
                          Array.isArray(response.data)
                        ) {
                          totalActivities.textContent = response.data.length;
                          tableBody.innerHTML = response.data
                            .map((log) => {
                              const timestamp = new Date(
                                log.performed_at
                              ).toLocaleString();

                              let roleBadge = `<span class="badge bg-primary-subtle text-primary">${
                                log.user_type || "N/A"
                              }</span>`;
                              if (
                                log.user_type
                                  ?.toLowerCase()
                                  .includes("compliance")
                              ) {
                                roleBadge = `<span class="badge bg-danger-subtle text-danger">${log.user_type}</span>`;
                              } else if (
                                log.user_type?.toLowerCase().includes("support")
                              ) {
                                roleBadge = `<span class="badge bg-warning-subtle text-warning">${log.user_type}</span>`;
                              }

                              const statusBadge =
                                log.status === "success"
                                  ? `<span class="badge bg-success">Success</span>`
                                  : `<span class="badge bg-danger">Failed</span>`;

                              return `
              <tr>
                <td class="pe-0">
                  <div class="form-check">
                    <input class="form-check-input" data-checkbox type="checkbox" />
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center mw-175px">
                    <div class="ms-2">${timestamp}</div>
                  </div>
                </td>
                <td>${log.user_email || "N/A"}</td>
                <td>${log.action_type || "N/A"}</td>
                <td>${roleBadge}</td>
                <td>${log.detail || "—"}</td>
                <td class="text-end">${statusBadge}</td>
              </tr>
            `;
                            })
                            .join("");
                        } else {
                          tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-muted">No logs found</td></tr>`;
                        }
                      })
                      .catch((err) => {
                        console.error(err);
                        tableBody.innerHTML = `<tr><td colspan="7" class="text-center text-danger">Error loading logs</td></tr>`;
                      });
                  });
                </script>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- begin::GXON Footer -->
    <!-- <footer class="footer-wrapper bg-body">
      <div class="container">
        <div class="row g-2">
          <div class="col-lg-6 col-md-7 text-center text-md-start">
            <p class="mb-0">
              © <span class="currentYear">2025</span> GXON. Proudly powered by
              <a href="javascript:void(0);">LayoutDrop</a>.
            </p>
          </div>
          <div class="col-lg-6 col-md-5">
            <ul
              class="d-flex list-inline mb-0 gap-3 flex-wrap justify-content-center justify-content-md-end"
            >
              <li>
                <a class="text-body" href="index.html">Home</a>
              </li>
              <li>
                <a class="text-body" href="pages/faq.html">Faq's</a>
              </li>
              <li>
                <a class="text-body" href="pages/faq.html">Support</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer> -->
    <!-- end::GXON Footer -->

    <script>
      // Make Export dropdown selective
      document
        .querySelectorAll("#exportDropdown + .dropdown-menu .dropdown-item")
        .forEach((item) => {
          item.addEventListener("click", function (e) {
            e.preventDefault();

            // Remove active from siblings
            let menu = this.closest(".dropdown-menu");
            menu
              .querySelectorAll(".dropdown-item")
              .forEach((i) => i.classList.remove("active"));

            // Add active to clicked item
            this.classList.add("active");

            // Update button text
            let button =
              this.closest(".btn-group").querySelector(".dropdown-toggle");
            button.innerHTML = `<i class="fi fi-rr-download me-1"></i> ${this.textContent}`;
          });
        });
    </script>

    <!-- begin::GXON Page Scripts -->
     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="assets/js/header.js"></script>
    <script src="assets/libs/global/global.min.js"></script>
    <script src="assets/libs/chartjs/chart.js"></script>
    <script src="assets/libs/apexcharts/apexcharts.min.js"></script>
    <script src="assets/libs/datatables/datatables.min.js"></script>
    <script src="assets/libs/flatpickr/flatpickr.min.js"></script>
    <script src="assets/js/flatpickr.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/appSettings.js"></script>
    <!-- <script src="assets/js/main.js"></script> -->
    <!-- end::GXON Page Scripts -->
    <script></script>
  </body>
</html>
