<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- begin::GXON Meta Basic -->
    <meta charset="utf-8" />
   <link rel="icon" type="image/png" href="assets/images/logo.jpeg" />
    <!-- end::GXON Meta Social -->

    <!-- begin::GXON Meta Twitter -->

    <!-- end::GXON Meta Twitter -->

    <!-- begin::GXON Website Page Title -->
    <title>Fusion</title>
    <!-- end::GXON Website Page Title -->

    <!-- begin::GXON Mobile Specific -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- begin::GXON Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
      rel="stylesheet"
    />
    <!-- end::GXON Google Fonts -->

    <!-- begin::GXON Required Stylesheet -->
    <link rel="stylesheet" href="assets/libs/flaticon/css/all/all.css" />
    <link rel="stylesheet" href="assets/libs/lucide/lucide.css" />
    <link rel="stylesheet" href="assets/libs/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="assets/libs/simplebar/simplebar.css" />
    <link rel="stylesheet" href="assets/libs/node-waves/waves.css" />
    <link
      rel="stylesheet"
      href="assets/libs/bootstrap-select/css/bootstrap-select.min.css"
    />
    <!-- end::GXON Required Stylesheet -->

    <!-- begin::GXON CSS Stylesheet -->
    <link rel="stylesheet" href="assets/libs/datatables/datatables.min.css" />
    <link rel="stylesheet" href="assets/libs/flatpickr/flatpickr.min.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <!-- end::GXON CSS Stylesheet -->

    <!-- begin::GXON Googletagmanager -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XWVQM68HHQ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-XWVQM68HHQ", {
        cookie_flags: "SameSite=None;Secure",
        send_page_view: true,
      });
    </script>
    <!-- end::GXON Googletagmanager -->
  </head>

  <body>
    <div class="page-layout">
      <!-- begin::GXON Page Header -->
      <header class="app-header">
        <div class="app-header-inner" id="header"></div>
      </header>
      <!-- end::GXON Page Header -->

      <div
        class="modal fade"
        id="searchResultsModal"
        tabindex="-1"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header py-1 px-3">
              <form
                class="d-flex align-items-center position-relative w-100"
                action="leave.html#"
              >
                <button
                  type="button"
                  class="btn btn-sm border-0 position-absolute start-0 p-0 text-sm"
                >
                  <i class="fi fi-rr-search"></i>
                </button>
                <input
                  type="text"
                  class="form-control form-control-lg ps-4 border-0 shadow-none"
                  id="searchInput"
                  placeholder="Search anything's"
                />
              </form>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body pb-2" style="height: 300px" data-simplebar>
              <div id="recentlyResults">
                <span
                  class="text-uppercase text-2xs fw-semibold text-muted d-block mb-2"
                  >Recently Searched:</span
                >
                <ul class="list-inline search-list">
                  <li>
                    <a class="search-item" href="index.html">
                      <i class="fi fi-rr-apps"></i> Dashboard
                    </a>
                  </li>
                  <li>
                    <a class="search-item" href="user.html">
                      <i class="fi fi-rr-comment"></i>User Management
                    </a>
                  </li>
                  <li>
                    <a class="search-item" href="roles.html">
                      <i class="fi fi-rr-calendar"></i>Roles & Access control
                    </a>
                  </li>
                  <li>
                    <a class="search-item" href="PTSP.html">
                      <i class="fi fi-rr-chart-pie-alt"></i> ptsp onboarding
                    </a>
                  </li>
                  <li>
                    <a class="search-item" href="data.html">
                      <i class="fi fi-rr-file"></i>data ingestion monitor
                    </a>
                  </li>
                  <li>
                    <a class="search-item" href="audit.html">
                      <i class="fi fi-rr-envelope"></i> audit log
                    </a>
                  </li>
                  <li>
                    <a class="search-item" href="transaction.html">
                      <i class="fi fi-rr-envelope"></i>Tax Transaction Config
                    </a>
                  </li>
                </ul>
              </div>
              <div id="searchContainer"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- begin::GXON Sidebar Menu -->
      <div id="sidebsr"></div>
      <!-- end::GXON Sidebar Menu -->

      <!-- begin::GXON Sidebar right -->
      <div class="app-sidebar-end"></div>
      <!-- end::GXON Sidebar right -->

      <main class="app-wrapper">
        <div class="container">
          <div
            class="app-page-head d-flex flex-wrap gap-3 align-items-center justify-content-between"
          >
            <div class="clearfix">
              <h1 class="app-page-title mb-4">Data Ingestion Monitor</h1>
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                  <!-- Filters & Actions -->
                  <div class="row g-2 align-items-center">
                    <div
                      class="col-lg-12 d-flex flex-wrap justify-content-between align-items-center gap-4"
                    >
                      <!-- Search Box on the Left -->
                      <div
                        class="mb-2 mb-md-0"
                        style="flex: 1; min-width: 350px; max-width: 450px"
                      >
                        <div class="input-group w-100">
                          <button class="btn btn-outline-primary" type="button">
                            <i class="fi fi-rr-search"></i>
                          </button>
                          <input
                            type="text"
                            class="form-control"
                            placeholder="Search..."
                            aria-label="Search"
                          />
                        </div>
                      </div>

                      <!-- Filters on the Right -->
                      <div class="d-flex flex-wrap gap-4 justify-content-end">
                        <!-- Ingestion Status Dropdown -->
                        <div>
                          <div class="btn-group">
                            <button
                              type="button"
                              class="btn btn-outline-light text-dark dropdown-toggle"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              id="ingestionDropdown"
                            >
                              Ingestion Status
                            </button>
                            <ul
                              class="dropdown-menu"
                              aria-labelledby="ingestionDropdown"
                            >
                              <li>
                                <a class="dropdown-item active" href="#">All</a>
                              </li>
                              <li>
                                <a class="dropdown-item" href="#">Successful</a>
                              </li>
                              <li>
                                <a class="dropdown-item" href="#">Pending</a>
                              </li>
                              <li>
                                <a class="dropdown-item" href="#">Failed</a>
                              </li>
                            </ul>
                          </div>
                        </div>

                        <!-- Export Dropdown -->
                        <div>
                          <div class="btn-group">
                            <button
                              type="button"
                              class="btn btn-primary dropdown-toggle"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              id="exportDropdown"
                            >
                              <i class="fi fi-rr-download me-1"></i> Export
                            </button>
                            <ul
                              class="dropdown-menu"
                              aria-labelledby="exportDropdown"
                            >
                              <li>
                                <a class="dropdown-item" href="#">Excel</a>
                              </li>
                              <li><a class="dropdown-item" href="#">CSV</a></li>
                              <li><a class="dropdown-item" href="#">PDF</a></li>
                            </ul>
                          </div>
                        </div>
                        <button
                          type="button"
                          class="btn btn-primary"
                          id="refreshButton"
                        >
                          <i class="fi fi-rr-rotate-right me-1"></i> Refresh
                        </button>
                      </div>
                    </div>
                  </div>
                </ol>
              </nav>
            </div>
          </div>

         <div class="row">
  <!-- Total BATCHES -->
  <div class="col-xxl-3 col-md-6 mb-4">
    <div class="card card-action action-border-primary position-relative">
      <div class="card-body d-flex justify-content-between align-items-start">
        <div class="d-flex align-items-center gap-2">
          <i class="fa-solid fa-database me-2 fs-3 text-primary"></i>
          <div>
            <small class="text-primary">TOTAL BATCHES</small>
            <h5 id="totalBatches" class="mb-0 fw-bold">0</h5>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Total SUCCESS -->
  <div class="col-xxl-3 col-md-6 mb-4">
    <div class="card card-action action-border-success">
      <div class="card-body d-flex justify-content-between align-items-start">
        <div class="d-flex align-items-center gap-2">
          <i class="fa-solid fa-circle-check me-2 fs-3 text-success"></i>
          <div>
            <small class="text-success">SUCCESS</small>
            <h5 id="totalSuccess" class="mb-0 fw-bold">0</h5>
            <small id="successText" class="text-muted">0 successful batches</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Total FAILED -->
  <div class="col-xxl-3 col-md-6 mb-4">
    <div class="card card-action action-border-danger position-relative">
      <div class="card-body d-flex align-items-center gap-2">
        <i class="fa-solid fa-circle-xmark text-danger fa-2x"></i>
        <div>
          <small class="text-danger">FAILED</small>
          <h5 id="totalFailed" class="mb-0 fw-bold">0</h5>
          <small id="failedText" class="text-muted">0 failed batches</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Total PENDING -->
  <div class="col-xxl-3 col-md-6 mb-4">
    <div class="card card-action action-border-warning position-relative">
      <div class="card-body d-flex justify-content-between align-items-start">
        <div class="d-flex align-items-center gap-2">
          <span class="bg-warning p-2 rounded-circle d-inline-flex align-items-center justify-content-center">
            <i class="fa-solid fa-clock text-dark fa-2x"></i>
          </span>
          <div>
            <small class="text-warning">PENDING</small>
            <h5 id="totalPending" class="mb-0 fw-bold">0</h5>
            <small id="pendingText" class="text-muted">0 pending batches</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
          <div class="col-lg-12">
            <div class="card overflow-hidden">
              <div class="col-lg-16">
                <div class="clearfix">
                  <div class="card">
                    <div class="card-header bg-body-secondary">
                      <!-- Optional header content -->
                    </div>
                    <div class="card-body">
                      <div class="tab-content">
                        <!-- All Merchants Tab -->
                        <div
                          class="tab-pane fade show active"
                          id="homeDefault"
                          role="tabpanel"
                          aria-labelledby="home-tabDefault"
                          tabindex="0"
                        >
                          <div class="card-body p-3">
                            <table
                              class="table table-striped table-hover align-middle table-row-bordered rounded"
                            >
                              <!-- Table Head -->
                              <thead class="table-light">
                                <tr>
                                  <th class="text-center" style="width: 50px">
                                    <input type="checkbox" id="selectAll" />
                                  </th>
                                  <th style="min-width: 120px">Batch ID</th>
                                  <th style="min-width: 150px">Channel</th>
                                  <th style="min-width: 150px">Records</th>
                                  <th style="min-width: 150px">Original IP</th>
                                  <th style="min-width: 130px">Time</th>
                                  <th style="min-width: 120px">Status</th>
                                </tr>
                              </thead>

                              <tbody id="batchTableBody"></tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- begin::GXON Footer -->
      <footer class="footer-wrapper bg-body">
        <div class="container">
          <div class="row g-2">
            <div class="col-lg-6 col-md-7 text-center text-md-start">
              <p class="mb-0">
                © <span class="currentYear">2025</span> GXON. Proudly powered by
                <a href="javascript:void(0);">LayoutDrop</a>.
              </p>
            </div>
            <div class="col-lg-6 col-md-5">
              <ul
                class="d-flex list-inline mb-0 gap-3 flex-wrap justify-content-center justify-content-md-end"
              >
                <li>
                  <a class="text-body" href="index.html">Home</a>
                </li>
                <li>
                  <a class="text-body" href="pages/faq.html">Faq's</a>
                </li>
                <li>
                  <a class="text-body" href="pages/faq.html">Support</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
      <!-- end::GXON Footer -->
    </div>

    <!-- Script to make dropdowns selective -->
    <script>
      document
        .querySelectorAll(".dropdown-menu .dropdown-item")
        .forEach((item) => {
          item.addEventListener("click", function (e) {
            e.preventDefault();

            // Remove active from siblings
            let menu = this.closest(".dropdown-menu");
            menu
              .querySelectorAll(".dropdown-item")
              .forEach((i) => i.classList.remove("active"));

            // Set active on clicked item
            this.classList.add("active");

            // Update button text
            let button =
              this.closest(".btn-group").querySelector(".dropdown-toggle");
            button.textContent = this.textContent;
          });
        });

      // Show selected date as label instead of placeholder
      const dateInput = document.getElementById("filterDate");
      dateInput.addEventListener("change", function () {
        if (this.value) {
          this.classList.add("is-valid"); // green border effect
        } else {
          this.classList.remove("is-valid");
        }
      });
    </script>

    <!-- begin::GXON Page Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="assets/js/header.js"></script>
    <script src="assets/libs/global/global.min.js"></script>
    <script src="assets/libs/chartjs/chart.js"></script>
    <script src="assets/libs/apexcharts/apexcharts.min.js"></script>
    <script src="assets/libs/datatables/datatables.min.js"></script>
    <script src="assets/libs/flatpickr/flatpickr.min.js"></script>
    <script src="assets/js/flatpickr.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/appSettings.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
      async function loadBatches() {
        try {
          const res = await axios.get(
            "https://arafatfootballacademy.com/fusion/backend/batches"
          );
          const batches = res.data.data;

          const tbody = document.getElementById("batchTableBody");
          tbody.innerHTML = "";

          batches.forEach((batch) => {
            let badgeClass = "bg-secondary";
            let badgeText = batch.status;

            if (batch.status === "completed") {
              badgeClass = "bg-success";
              badgeText = "Success";
            } else if (batch.status === "failed") {
              badgeClass = "bg-danger";
              badgeText = "Failed";
            } else if (batch.status === "partial") {
              badgeClass = "bg-warning text-dark";
              badgeText = "Partial";
            }

            const row = `
          <tr>
            <td class="text-center">
              <input type="checkbox" class="row-checkbox" />
            </td>
            <td>${batch.batch_number}</td>
            <td>${batch.provider_name}</td>
            <td>${batch.total_transactions}</td>
            <td>—</td>
            <td>${new Date(batch.created_at).toLocaleString()}</td>
            <td>
              <span class="badge ${badgeClass}">${badgeText}</span>
            </td>
          </tr>
        `;
            tbody.insertAdjacentHTML("beforeend", row);
          });

          const selectAll = document.getElementById("selectAll");
          selectAll.addEventListener("change", function () {
            document.querySelectorAll(".row-checkbox").forEach((cb) => {
              cb.checked = selectAll.checked;
            });
          });
        } catch (err) {
          console.error("Error fetching batch data:", err);
        }
      }

      document.addEventListener("DOMContentLoaded", loadBatches);

  async function loadBatchStats() {
    try {
      const res = await axios.get(
        "https://arafatfootballacademy.com/fusion/backend/batches"
      ); 
      const data = res.data.data;

      let total = data.length;
      let success = data.filter(b => b.status === "completed").length;
      let failed = data.filter(b => b.status === "failed").length;
      let pending = data.filter(b => b.status === "pending").length;

      // update DOM
      document.getElementById("totalBatches").textContent = total;
      document.getElementById("totalSuccess").textContent = success;
      document.getElementById("successText").textContent = `${success} successful batches`;
      document.getElementById("totalFailed").textContent = failed;
      document.getElementById("failedText").textContent = `${failed} failed batches`;
      document.getElementById("totalPending").textContent = pending;
      document.getElementById("pendingText").textContent = `${pending} pending batches`;

    } catch (err) {
      console.error("Error loading batch stats:", err);
    }
  }

  document.addEventListener("DOMContentLoaded", loadBatchStats);
</script>
    <!-- end::GXON Page Scripts -->
  </body>
</html>
