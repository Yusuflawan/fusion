<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Invoice PDF Generator (Vanilla JS)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Inter, Arial, sans-serif; background:#f4f6f9; margin:0; padding:24px; }
    .page { width: 800px; margin: 0 auto; }
    .card { background:#fff; border-radius:10px; padding:28px; box-shadow:0 6px 18px rgba(10,10,10,0.06); }
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:18px; }
    .company { font-weight:700; font-size:20px; }
    .meta { text-align:right; font-size:14px; color:#444; }
    .section { margin-top:16px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:12px 8px; border-bottom:1px solid #eee; text-align:left; }
    th { font-weight:600; color:#333; }
    .total-row td { font-weight:700; font-size:16px; }
    .badge { display:inline-block; padding:6px 10px; border-radius:14px; font-size:13px; color:#fff; }
    .badge.pending { background:#f59e0b; }
    .badge.paid { background:#10b981; }
    .controls { display:flex; gap:8px; justify-content:center; margin:18px 0; }
    button { background:#0f172a; color:white; padding:10px 14px; border-radius:8px; border:none; cursor:pointer; }
    button.secondary { background:#64748b; }
    @media print {
      body { background: white; }
      .page { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card" id="invoice-card">
      <header>
        <div>
          <div class="company">Acme Tax Services</div>
          <div style="font-size:13px;color:#555">No. 10 Broad Street, Lagos<br/>TIN: 1234567890</div>
        </div>
        <div class="meta" id="meta"></div>
      </header>

      <div class="section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <div style="font-weight:700">Invoice</div>
            <div id="assessmentId" style="color:#666"></div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:13px;color:#666">Assessment Period</div>
            <div id="period" style="font-weight:600"></div>
          </div>
        </div>

        <table aria-labelledby="charges">
          <thead>
            <tr>
              <th>Description</th>
              <th style="width:160px">Amount</th>
            </tr>
          </thead>
          <tbody id="line-items"></tbody>
          <tfoot>
            <tr class="total-row">
              <td>Total Revenue</td>
              <td id="revenueTotal"></td>
            </tr>
            <tr class="total-row">
              <td>Tax Liability</td>
              <td id="taxLiabilityTotal"></td>
            </tr>
          </tfoot>
        </table>

        <div style="display:flex; justify-content:space-between; margin-top:18px; align-items:center;">
          <div>
            <div style="font-size:13px;color:#666">Due Date</div>
            <div id="dueDate" style="font-weight:700"></div>
          </div>
          <div>
            <div style="font-size:13px;color:#666">Status</div>
            <div id="statusBadge"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
       <button id="downloadPdf">Generate PDF</button>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>

  <script>
    // sample JSON
    const sample = {
      "assessmentId": "ASS-2024-001",
      "period": "January 2024",
      "revenue": 3600000,
      "taxLiability": 180000,
      "dueDate": "2024-02-15",
      "status": "pending"
    };

    const LOCALE = 'en-NG';
    const CURRENCY = 'NGN';

    function formatCurrency(amount) {
      try {
        return new Intl.NumberFormat(LOCALE, { style: 'currency', currency: CURRENCY }).format(amount);
      } catch {
        return 'â‚¦' + Number(amount).toLocaleString();
      }
    }

    function formatDate(iso) {
      const d = new Date(iso);
      return isNaN(d) ? iso : d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function renderInvoice(data) {
      document.getElementById('assessmentId').textContent = data.assessmentId;
      document.getElementById('period').textContent = data.period;

      const lineItemsBody = document.getElementById('line-items');
      lineItemsBody.innerHTML = '';
      [
        { desc: 'Total revenue for period', amount: data.revenue },
        { desc: 'Tax liability', amount: data.taxLiability }
      ].forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.desc}</td><td>${formatCurrency(item.amount)}</td>`;
        lineItemsBody.appendChild(tr);
      });

      document.getElementById('revenueTotal').textContent = formatCurrency(data.revenue);
      document.getElementById('taxLiabilityTotal').textContent = formatCurrency(data.taxLiability);
      document.getElementById('dueDate').textContent = formatDate(data.dueDate);

      const badge = document.getElementById('statusBadge');
      badge.innerHTML = '';
      const span = document.createElement('span');
      span.className = 'badge ' + (data.status === 'paid' ? 'paid' : 'pending');
      span.textContent = data.status;
      badge.appendChild(span);

      document.getElementById('meta').innerHTML = `
        <div>Invoice #: <strong>${data.assessmentId}</strong></div>
        <div style="margin-top:8px;">Generated: <strong>${formatDate(new Date().toISOString())}</strong></div>
      `;
    }

    async function generatePdf() {
      const el = document.getElementById('invoice-card');
      const canvas = await html2canvas(el, { scale: 2, useCORS: true });
      const imgData = canvas.toDataURL('image/png');

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'pt', 'a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      const ratio = Math.min(pageWidth / canvas.width, pageHeight / canvas.height);
      const imgWidth = canvas.width * ratio;
      const imgHeight = canvas.height * ratio;

      const x = (pageWidth - imgWidth) / 2;
      const y = 20;

      pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
      pdf.save(`${sample.assessmentId}.pdf`);
    }

    document.getElementById('downloadPdf').addEventListener('click', generatePdf);

    renderInvoice(sample);
  </script>
</body>
</html>
