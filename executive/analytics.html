<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- begin::GXON Meta Basic -->
    <meta charset="utf-8" />
    <title>Analytics | fusion HR Management Admin Dashboard</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- end::GXON Mobile Specific -->

    <!-- begin::GXON Favicon Tags -->
    <link rel="icon" type="image/png" href="assets/images/logo.jpeg" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/images/logo.jpeg"
    />
    <!-- end::GXON Favicon Tags -->

    <!-- begin::GXON Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
      rel="stylesheet"
    />
    <!-- end::GXON Google Fonts -->

    <!-- begin::GXON Required Stylesheet -->
    <link rel="stylesheet" href="assets/libs/flaticon/css/all/all.css" />
    <link rel="stylesheet" href="assets/libs/lucide/lucide.css" />
    <link rel="stylesheet" href="assets/libs/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="assets/libs/simplebar/simplebar.css" />
    <link rel="stylesheet" href="assets/libs/node-waves/waves.css" />
    <link
      rel="stylesheet"
      href="assets/libs/bootstrap-select/css/bootstrap-select.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- end::GXON Required Stylesheet -->
    <!-- begin::GXON CSS Stylesheet -->
    <link rel="stylesheet" href="assets/libs/flatpickr/flatpickr.min.css" />
    <link rel="stylesheet" href="assets/libs/datatables/datatables.min.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- end::GXON CSS Stylesheet -->

    <!-- begin::GXON Googletagmanager -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XWVQM68HHQ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-XWVQM68HHQ", {
        cookie_flags: "SameSite=None;Secure",
        send_page_view: true,
      });
    </script>
    <!-- end::GXON Googletagmanager -->
     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>

  <body>
    <main>
      <div class="page-layout">
        <!-- begin::GXON Page Header -->
        <header class="app-header">
          <div class="app-header-inner" id="header"></div>
        </header>
        <!-- end::GXON Page Header -->

        <div
          class="modal fade"
          id="searchResultsModal"
          tabindex="-1"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header py-1 px-3">
                <form
                  class="d-flex align-items-center position-relative w-100"
                  action="analytics.html#"
                >
                  <button
                    type="button"
                    class="btn btn-sm border-0 position-absolute start-0 p-0 text-sm"
                  >
                    <i class="fi fi-rr-search"></i>
                  </button>
                  <input
                    type="text"
                    class="form-control form-control-lg ps-4 border-0 shadow-none"
                    id="searchInput"
                    placeholder="Search anything's"
                  />
                </form>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body pb-2" style="height: 300px" data-simplebar>
                <div id="recentlyResults">
                  <span
                    class="text-uppercase text-2xs fw-semibold text-muted d-block mb-2"
                    >Recently Searched:</span
                  >
                  <ul class="list-inline search-list">
                    <li>
                      <a class="search-item" href="index.html">
                        <i class="fi fi-rr-apps"></i> Dashboard
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="chat.html">
                        <i class="fi fi-rr-comment"></i> Chat
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="calendar.html">
                        <i class="fi fi-rr-calendar"></i> Calendar
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="chart/apexchart.html">
                        <i class="fi fi-rr-chart-pie-alt"></i> Apexchart
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="pages/pricing.html">
                        <i class="fi fi-rr-file"></i> Pricing
                      </a>
                    </li>
                    <li>
                      <a class="search-item" href="email/inbox.html">
                        <i class="fi fi-rr-envelope"></i> Email
                      </a>
                    </li>
                  </ul>
                </div>
                <div id="searchContainer"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- begin::GXON Sidebar Menu -->
        <div id="sidebsr"></div>
        <!-- end::GXON Sidebar Menu -->

        <!-- begin::GXON Sidebar right -->
        <div class="app-sidebar-end"></div>
        <!-- end::GXON Sidebar right -->
        <div class="app-wrapper">
          <div
            class="d-flex justify-content-between align-items-start mb-0 p-2"
          >
            <div>
              <h2 class="fw-bold mb-0">Strategic Analytics</h2>
              <p class="text-muted mb-1">
                Advanced analytics for strategic decision making
              </p>
            </div>
            <div class="d-flex flex-wrap gap-2">
              <!-- Analysis Dropdown -->
              <select class="form-select form-select-sm w-auto">
                <option selected>Revenue Analysis</option>
                <option value="1">Compliance Analysis</option>
                <option value="2">Growth Analysis</option>
              </select>

              <!-- Month Dropdown -->
              <select class="form-select form-select-sm w-auto">
                <option selected>Select Period</option>
                <option value="1">6 Months</option>
                <option value="2">3 Months</option>
                <option value="3">1 Year</option>
              </select>
            </div>
          </div>

          <div class="d-flex justify-content-center py-4">
            <div class="container py-4" style="max-width: 1100px; width: 100%">
              <!-- ===== Top Metric Cards ===== -->
              <div class="row g-3 mb-4">
                <div class="col-md-3">
                  <div class="card rounded-4 shadow-sm">
                    <div class="card-body">
                      <h6 class="mb-4 d-flex justify-content-between">
                        Revenue Efficiency
                        <i class="bi bi-graph-up-arrow text-success"></i>
                      </h6>
                      <div class="fs-2 fw-bold" id="revenueEfficiency"></div>
                      <p class="small text-muted mb-0">
                        Target achievement rate
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card rounded-4 shadow-sm">
                    <div class="card-body">
                      <h6 class="mb-4 d-flex justify-content-between">
                        Market Penetration
                        <i class="bi bi-bar-chart-line text-primary"></i>
                      </h6>
                      <div class="fs-2 fw-bold" id="marketPenetration"></div>
                      <p class="small text-muted mb-0">Of eligible merchants</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card rounded-4 shadow-sm">
                    <div class="card-body">
                      <h6 class="mb-4 d-flex justify-content-between">
                        Revenue per Merchant
                        <i class="bi bi-currency-dollar text-purple"></i>
                      </h6>
                      <div class="fs-2 fw-bold" id="revenuePerMarchant"></div>
                      <p class="small text-muted mb-0">Monthly average</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card rounded-4 shadow-sm">
                    <div class="card-body">
                      <h6 class="mb-4 d-flex justify-content-between">
                        Prediction Accuracy
                        <i class="bi bi-bar-chart text-warning"></i>
                      </h6>
                      <div class="fs-2 fw-bold">87.3%</div>
                      <p class="small text-muted mb-0">Forecast reliability</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ===== Forecast Chart Card ===== -->
              <div class="card rounded-4 shadow-sm mb-4">
                <div class="card-body">
                  <h6 class="fw-bold">Revenue Forecast &amp; Projections</h6>
                  <p class="small text-muted mb-4">
                    Predictive analysis with confidence intervals
                  </p>
                  <canvas id="forecastChart" height="100"></canvas>
                </div>
              </div>

              <!-- ===== Sector Contribution Section ===== -->
              <div class="card rounded-4 shadow-sm">
                <div class="card-body">
                  <h6 class="fw-bold">Sector Contribution Analysis</h6>
                  <p class="small text-muted mb-4">
                    Revenue contribution and growth by economic sector
                  </p>

                  <div id="sectorContainer">
                    <div class="placeholder-glow mb-3">
                      <div class="d-flex justify-content-between mb-2">
                        <span class="placeholder col-3"></span>
                        <span class="placeholder col-6"></span>
                      </div>
                      <div class="progress" style="height: 6px">
                        <div
                          class="progress-bar bg-light placeholder col-12"
                          style="width: 100%"
                        ></div>
                      </div>
                    </div>

                    <div class="placeholder-glow mb-3">
                      <div class="d-flex justify-content-between mb-2">
                        <span class="placeholder col-2"></span>
                        <span class="placeholder col-5"></span>
                      </div>
                      <div class="progress" style="height: 6px">
                        <div
                          class="progress-bar bg-light placeholder col-12"
                          style="width: 100%"
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <script>
                document.addEventListener(
                  "DOMContentLoaded",
                  async function () {
                    const container =
                      document.getElementById("sectorContainer");

                    try {
                      const response = await fetch(
                        "https://arafatfootballacademy.com/fusion/backend/executive/32/sector-distribution-analysis"
                      );
                      const result = await response.json();
                      container.innerHTML = "";

                      result.data.forEach((item) => {
                        const percentage =
                          parseFloat(item.revenue_percentage) || 0;
                        const growth = "+8.5%";
                        const growthClass = "text-success";
                        const risk = {
                          label: "medium risk",
                          class: "bg-warning-subtle text-warning",
                        };

                        const sectorBlock = `
          <div class="d-flex justify-content-between mb-2">
            <strong>${item.business_type}</strong>
            <div class="text-end small">
              <span class="text-secondary">${percentage.toFixed(
                1
              )}% of total revenue</span>
              <span class="ms-2 ${growthClass} fw-bold">${growth}</span>
              <span class="badge ${risk.class} ms-1">${risk.label}</span>
            </div>
          </div>
          <div class="progress mb-3" style="height:6px;">
            <div class="progress-bar bg-primary" style="width: ${percentage}%;"></div>
          </div>
        `;

                        container.insertAdjacentHTML("beforeend", sectorBlock);
                      });
                    } catch (error) {
                      console.error("Error loading sector data:", error);
                      container.innerHTML = `<p class="text-danger small">Failed to load data.</p>`;
                    }
                  }
                );
              </script>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- begin::GXON Footer -->
    <footer class="footer-wrapper bg-body">
      <div class="container">
        <div class="row g-2">
          <div class="col-lg-6 col-md-7 text-center text-md-start">
            <p class="mb-0">
              © <span class="currentYear">2025</span></a>.
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!-- end::GXON Footer -->

    <script>
      const ctx = document.getElementById("forecastChart");
      new Chart(ctx, {
        type: "line",
        data: {
          labels: [
            "Jul 2024",
            "Aug 2024",
            "Sep 2024",
            "Oct 2024",
            "Nov 2024",
            "Dec 2024",
          ],
          datasets: [
            {
              data: [3200000, 3300000, 3400000, 3500000, 3600000, 3700000],
              borderColor: "#007bff",
              borderDash: [5, 5],
              tension: 0.1,
              pointBackgroundColor: "#007bff",
              pointRadius: 4,
              fill: false,
            },
          ],
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true },
          },
        },
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- begin::GXON Page Scripts -->
    <script src="assets/libs/global/global.min.js"></script>
    <script src="assets/js/header.js"></script>
    <script src="assets/libs/sortable/Sortable.min.js"></script>
    <script src="assets/libs/chartjs/chart.js"></script>
    <script src="assets/libs/flatpickr/flatpickr.min.js"></script>
    <script src="assets/libs/apexcharts/apexcharts.min.js"></script>
    <script src="assets/libs/datatables/datatables.min.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/todolist.js"></script>
    <script src="assets/js/appSettings.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
      const baseUrl = "https://arafatfootballacademy.com/fusion/backend";

      const revenueEfficiency = document.querySelector("#revenueEfficiency");
      const marketPenetration = document.querySelector("#marketPenetration");
      const revenuePerMarchant = document.querySelector("#revenuePerMarchant");

      const stateId = 32;
      const period = "last_30_days";

      async function loadData() {
        try {
          revenueEfficiency.textContent = "Loading...";
          marketPenetration.textContent = "...";
          revenuePerMarchant.textContent = "...";

          const [revenueEfficiencyRes, marketPenetrationRes, revenuePerMarchantRes] =
            await Promise.all([
              axios.get(
                `${baseUrl}/executive/${stateId}/revenue-efficiency`
              ),
              axios.get(
                `${baseUrl}/executive/${stateId}/market-penetration`
              ),
              axios.get(
                `${baseUrl}/executive/${stateId}/revenue-per-marchant`
              ),
            ]);

            // console.log(revenueEfficiencyRes,marketPenetrationRes,revenuePerMarchantRes)


          // Compliance Status
          if (revenueEfficiencyRes.data.status === "success") {
            revenueEfficiency.textContent = `${revenueEfficiencyRes.data.data.revenue_efficiency}%`
          } else {
            revenueEfficiency.textContent = "N/A";
          }

          // Transaction Volume
          if (marketPenetrationRes.data?.status === "success") {
            marketPenetration.textContent = `${marketPenetrationRes.data.data.market_penetration}%`
            // activeMerchants.textContent = "text";
          } else {
            marketPenetration.textContent = "N/A";
          }

          // Revenue
          if (revenuePerMarchantRes.data?.status === "success") {
            revenuePerMarchant.textContent = formatToNaira(
              revenuePerMarchantRes.data.data.avg_revenue_per_marchant
            );
          } else {
            revenuePerMarchant.textContent = "N/A";
          }
        } catch (error) {
          // totalRevenue.textContent = "Error";
          // complianceRate.textContent = "Error";
          // activeMerchants.textContent = "Error";
        }
      }

      function formatToNaira(num) {
        const n = Number(num) || 0;
        if (n >= 1_000_000_000) return `₦${(n / 1_000_000_000).toFixed(1)}B`;
        if (n >= 1_000_000) return `₦${(n / 1_000_000).toFixed(1)}M`;
        if (n >= 1_000) return `₦${(n / 1_000).toFixed(1)}K`;
        return `₦${n.toLocaleString()}`;
      }

      loadData();
    </script>
    <!-- end::GXON Page Scripts -->
  </body>
</html>
