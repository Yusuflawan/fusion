<!DOCTYPE html>
<html lang="en">

<head>
  <!-- begin::GXON Meta Basic -->
  <meta charset="utf-8" />

  <link rel="icon" type="image/png" href="assets/images/logo.jpeg" />
  <title>fusion HR Management Admin Dashboard</title>
  <!-- end::GXON Website Page Title -->

  <!-- begin::GXON Mobile Specific -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- end::GXON Mobile Specific -->

  <link rel="apple-touch-icon" sizes="180x180" href="assets/images/logo.jpeg" />
  <!-- end::GXON Favicon Tags -->

  <!-- begin::GXON Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
    rel="stylesheet" />
  <!-- end::GXON Google Fonts -->

  <!-- begin::GXON Required Stylesheet -->
  <link rel="stylesheet" href="assets/libs/flaticon/css/all/all.css" />
  <link rel="stylesheet" href="assets/libs/lucide/lucide.css" />
  <link rel="stylesheet" href="assets/libs/fontawesome/css/all.min.css" />
  <link rel="stylesheet" href="assets/libs/simplebar/simplebar.css" />
  <link rel="stylesheet" href="assets/libs/node-waves/waves.css" />
  <link rel="stylesheet" href="assets/libs/bootstrap-select/css/bootstrap-select.min.css" />
  <!-- end::GXON Required Stylesheet -->

  <!-- begin::GXON CSS Stylesheet -->
  <link rel="stylesheet" href="assets/libs/flatpickr/flatpickr.min.css" />
  <link rel="stylesheet" href="assets/libs/datatables/datatables.min.css" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <!-- Bootstrap core CSS (already in your project) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Add this line for Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- end::GXON CSS Stylesheet -->

  <!-- begin::GXON Googletagmanager -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XWVQM68HHQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-XWVQM68HHQ", {
      cookie_flags: "SameSite=None;Secure",
      send_page_view: true,
    });
  </script>
  <!-- end::GXON Googletagmanager -->
</head>

<body>
  <div class="page-layout">
    <!-- begin::GXON Page Header -->
    <header class="app-header">
      <div class="app-header-inner" id="header"></div>
    </header>
    <!-- end::GXON Page Header -->

    <div class="modal fade" id="searchResultsModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header py-1 px-3">
            <form class="d-flex align-items-center position-relative w-100" action="index.html#">
              <button type="button" class="btn btn-sm border-0 position-absolute start-0 p-0 text-sm">
                <i class="fi fi-rr-search"></i>
              </button>
              <input type="text" class="form-control form-control-lg ps-4 border-0 shadow-none" id="searchInput"
                placeholder="Search anything's" />
            </form>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body pb-2" style="height: 300px" data-simplebar>
            <div id="recentlyResults">
              <span class="text-uppercase text-2xs fw-semibold text-muted d-block mb-2">Recently Searched:</span>
              <ul class="list-inline search-list">
                <li>
                  <a class="search-item" href="index.html">
                    <i class="fi fi-rr-apps"></i> Dashboard
                  </a>
                </li>
                <li>
                  <a class="search-item" href="chat.html">
                    <i class="fi fi-rr-comment"></i> Chat
                  </a>
                </li>
                <li>
                  <a class="search-item" href="calendar.html">
                    <i class="fi fi-rr-calendar"></i> Calendar
                  </a>
                </li>
                <li>
                  <a class="search-item" href="chart/apexchart.html">
                    <i class="fi fi-rr-chart-pie-alt"></i> Apexchart
                  </a>
                </li>
                <li>
                  <a class="search-item" href="pages/pricing.html">
                    <i class="fi fi-rr-file"></i> Pricing
                  </a>
                </li>
                <li>
                  <a class="search-item" href="email/inbox.html">
                    <i class="fi fi-rr-envelope"></i> Email
                  </a>
                </li>
              </ul>
            </div>
            <div id="searchContainer"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- begin::GXON Sidebar Menu -->
    <div class="app-menubar" id="sidebsr"></div>
    <!-- end::GXON Sidebar Menu -->

    <!-- begin::GXON Sidebar right -->
    <div class="app-sidebar-end">
    </div>
    <!-- end::GXON Sidebar right -->

    <main class="app-wrapper">
      <div class="container">
        <div class="app-page-head d-flex flex-wrap gap-3 align-items-center justify-content-between">
          <div class="clearfix">
            <h1 class="app-page-title">Dashboard</h1>
            <span>Strategic overview of Plateau State IGR performance</span>
          </div>
        </div>
        <!-- DASHBOARD LAYOUT -->
        <div class="container-fluid py-4">

          <!-- Top Metric Cards -->
          <div class="row g-4 mb-4">
            <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Total Revenue (MTD)</h6>
                    <!-- icon absolutely positioned -->
                    <i class="bi bi-currency-dollar fs-3 text-secondary position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark" id="total_revenue">2</div>
                  <div class="text-success small">+12.5% from last month</div>
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Active Merchants</h6>
                    <i class="bi bi-people fs-5 text-secondary  position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark" id="active_merchants">2</div>
                  <div class="text-success small">+8.2% new registrations</div>
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Compliance Rate</h6>
                    <i class="bi bi-bar-chart-line fs-5 text-secondary  position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark" id="compliance_rate">85.6%</div>
                  <div class="text-success small">+2.1% improvement</div>
                </div>
              </div>
            </div>

            <!-- <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Risk Alerts</h6>
                    <i
                      class="bi bi-exclamation-triangle fs-5 text-secondary  position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark">47</div>
                  <div class="text-danger small">+5 new this week</div>
                </div>
              </div> -->
            </div>
          </div>

          <!-- Revenue Trend & Compliance Distribution -->
          <div class="row g-3 mt-1">
            <div class="col-md-8">
              <div class="card p-3 h-100">
                <h6 class="fw-bold">Revenue Trend</h6>
                <p class="text-muted mb-2">Monthly IGR performance vs targets</p>
                <div class="chart-container">
                  <canvas id="revenueChart"></canvas>
                </div>
              </div>
            </div>
 

            <div class="col-md-4">
              <div class="card p-3 h-100">
                <h6 class="fw-bold">Compliance Distribution</h6>
                <p class="text-muted mb-2">Merchant compliance status</p>
                <div class="chart-container">
                  <canvas id="complianceChart"></canvas>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="container mt-5">
          <div class="card rounded-3">
            <div class="card-body">
              <h5 class="fw-bold mb-1">Top Performing LGAs</h5>
              <p class="text-muted mb-4">Revenue and compliance by Local Government Area</p>

             <div class="table-responsive">
 <table class="table align-middle table-hover">
  <thead class="table-light">
    <tr>
      <th scope="col" class="ps-4">Local Government Area</th>
      <th scope="col">Total Revenue (â‚¦)</th>
      <th scope="col">Compliance Rate (%)</th>
      <th scope="col">Total Merchants</th>
      <th scope="col">Total Assessments</th>
      <th scope="col">Paid Assessments</th>
      <th scope="col">Revenue Growth (%)</th>
      <th scope="col" class="pe-4 text-center">Status</th>
    </tr>
  </thead>
  <tbody id="lga-table-body"></tbody>
</table>


</div>
          </div>
        </div>
      </div>


    </main>

    <!-- begin::GXON Footer -->
    <footer class="footer-wrapper bg-body">
      <div class="container">
        <div class="row g-2">
          <div class="col-lg-6 col-md-7 text-center text-md-start">
            <p class="mb-0">
              Â© <span class="currentYear">2025</span>. Proudly powered by
              <a href="javascript:void(0);">Binarifylimited</a>.
            </p>
          </div>
          <div class="col-lg-6 col-md-5">
            <ul class="d-flex list-inline mb-0 gap-3 flex-wrap justify-content-center justify-content-md-end">
              <li>
                <a class="text-body" href="index.html">Home</a>
              </li>
              <li>
                <a class="text-body" href="pages/faq.html">Faq's</a>
              </li>
              <li>
                <a class="text-body" href="pages/faq.html">Support</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <!-- end::GXON Footer -->
  </div>
  <!-- Load Chart.js once -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<!-- Loading Spinner -->
<!-- <div id="loading" style="text-align:center; padding:20px;">
  <div class="spinner" 
       style="width:40px; height:40px; border:4px solid #ddd; border-top:4px solid #007bff; border-radius:50%; animation: spin 1s linear infinite; margin:auto;">
  </div>
  <p>Loading charts...</p>
</div> -->


<!-- <canvas id="revenueChart" style="display:none; max-height:300px;"></canvas>
<canvas id="complianceChart" style="display:none; max-height:300px;"></canvas> -->

<!-- <style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style> -->

<script>
  const apiUrl = "https://arafatfootballacademy.com/fusion/backend/executive/lga-performance"; 

  function getStatusBadge(status) {
    if (!status) {
      return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-secondary bg-secondary-subtle">
                No Data
              </span>`;
    }

    switch (status.toLowerCase()) {
      case "excellent":
        return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-success bg-success-subtle">${status}</span>`;
      case "good":
        return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-warning bg-warning-subtle">${status}</span>`;
      case "poor":
      default:
        return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-danger bg-danger-subtle">${status}</span>`;
    }
  }

  async function loadLgaData() {
    try {
      const response = await fetch(apiUrl);
      const result = await response.json();

      const tbody = document.getElementById("lga-table-body");
      tbody.innerHTML = "";

      result.data.forEach(item => {
        const compliance = item.compliance_rate !== null ? parseFloat(item.compliance_rate) : null;

        const row = `
          <tr>
            <td class="ps-4">${item.lga_name}</td>
            <td>â‚¦${Number(item.total_revenue).toLocaleString()}</td>
            <td>${compliance !== null ? compliance + "%" : "-"}</td>
            <td>${item.total_merchants}</td>
            <td>${item.total_assessments}</td>
            <td>${item.paid_assessments}</td>
            <td>${item.revenue_growth}</td>
            <td class="pe-4">
              ${getStatusBadge(item.status)}
            </td>
          </tr>
        `;

        tbody.insertAdjacentHTML("beforeend", row);
      });

    } catch (error) {
      console.error("Error fetching LGA data:", error);
    }
  }

  document.addEventListener("DOMContentLoaded", loadLgaData);
</script>




  <!-- begin::GXON Page Scripts -->

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="assets/js/header.js"></script>
  <!-- <script src="assets/js/logic/dashboard.js"></script> -->
  <!-- <script src="assets/libs/global/global.min.js"></script> -->
  <script src="assets/libs/sortable/Sortable.min.js"></script>
  <script src="assets/libs/chartjs/chart.js"></script>
  <script src="assets/libs/flatpickr/flatpickr.min.js"></script>
  <script src="assets/libs/apexcharts/apexcharts.min.js"></script>
  <script src="assets/libs/datatables/datatables.min.js"></script>
  <script src="assets/js/dashboard.js"></script>
  <script src="assets/js/todolist.js"></script>
  <script src="assets/js/appSettings.js"></script>
  <!-- <script src="assets/js/main.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// const baseUrl = "https://arafatfootballacademy.com/fusion/backend";

const totalRevenue = document.querySelector("#total_revenue");
const activeMerchants = document.querySelector("#active_merchants");
const complianceRate = document.querySelector("#compliance_rate");

const stateId = 32;
const period = "last_30_days";

async function loadData() {
  try {
    totalRevenue.textContent = "Loading...";
    activeMerchants.textContent = "...";
    complianceRate.textContent = "...";

    const res = await axios.get(`${baseUrl}/executive/dashboard-cards`);
    const { status, data } = res.data;

    if (status === "success" && data) {
      totalRevenue.textContent = formatToNaira(data.total_revenue);
      activeMerchants.textContent = data.active_merchants.toLocaleString();
      complianceRate.textContent = `${data.compliance_rate}%`;
    } else {
      totalRevenue.textContent = "N/A";
      activeMerchants.textContent = "N/A";
      complianceRate.textContent = "N/A";
    }
  } catch (error) {
    console.error("Error loading dashboard data:", error);
    totalRevenue.textContent = "Error";
    activeMerchants.textContent = "Error";
    complianceRate.textContent = "Error";
  }
}

function formatToNaira(num) {
  const n = Number(num) || 0;
  if (n >= 1_000_000_000) return `â‚¦${(n / 1_000_000_000).toFixed(1)}B`;
  if (n >= 1_000_000) return `â‚¦${(n / 1_000_000).toFixed(1)}M`;
  if (n >= 1_000) return `â‚¦${(n / 1_000).toFixed(1)}K`;
  return `â‚¦${n.toLocaleString()}`;
}

document.addEventListener("DOMContentLoaded", loadData);

// const baseUrl = "https://arafatfootballacademy.com/fusion/backend";

const ctx = document.getElementById("revenueChart").getContext("2d");
let revenueChartInstance = null;

function formatToNaira(amount) {
  return "â‚¦" + Number(amount).toLocaleString("en-NG", { maximumFractionDigits: 2 });
}

async function loadRevenueTrend() {
  try {
    const res = await fetch(`${baseUrl}/executive/revenue-trend`);
    const json = await res.json();
    const data = json.data || [];

    const labels = data.map(item => item.month_name);
    const revenues = data.map(item => parseFloat(item.total_revenue));

    if (revenueChartInstance) revenueChartInstance.destroy();

    revenueChartInstance = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [
          {
            label: "Total Revenue (â‚¦)",
            data: revenues,
            borderColor: "#0d6efd",
            backgroundColor: "rgba(13, 110, 253, 0.1)",
            fill: true,
            tension: 0.4,
            pointRadius: 4,
            pointBackgroundColor: "#0d6efd",
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: "top",
          },
          tooltip: {
            callbacks: {
              label: function (context) {
                return formatToNaira(context.parsed.y);
              },
            },
          },
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function (value) {
                return "â‚¦" + value.toLocaleString();
              },
            },
          },
        },
      },
    });
  } catch (error) {
    console.error("Error loading revenue trend:", error);
  }
}

document.addEventListener("DOMContentLoaded", loadRevenueTrend);

// const baseUrl = "https://arafatfootballacademy.com/fusion/backend";

const complianceCtx = document.getElementById("complianceChart").getContext("2d");
let complianceChartInstance = null;

async function loadComplianceDistribution() {
  try {
    const res = await fetch(`${baseUrl}/executive/compliance-distribution`);
    const json = await res.json();
    const data = json.data || {};

    const compliant = parseInt(data.compliant_marchants) || 0;
    const partiallyCompliant = parseInt(data.partially_compliant_marchants) || 0;
    const nonCompliant = parseInt(data.non_compliant_marchants) || 0;

    if (complianceChartInstance) complianceChartInstance.destroy();

    complianceChartInstance = new Chart(complianceCtx, {
      type: "doughnut",
      data: {
        labels: ["Compliant", "Partially Compliant", "Non-Compliant"],
        datasets: [
          {
            label: "Merchant Distribution",
            data: [compliant, partiallyCompliant, nonCompliant],
            backgroundColor: [
              "rgba(40, 167, 69, 0.8)",  
              "rgba(255, 193, 7, 0.8)",  
              "rgba(220, 53, 69, 0.8)",  
            ],
            borderColor: [
              "rgba(40, 167, 69, 1)",
              "rgba(255, 193, 7, 1)",
              "rgba(220, 53, 69, 1)",
            ],
            borderWidth: 1,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: "bottom",
            labels: { usePointStyle: true },
          },
          tooltip: {
            callbacks: {
              label: function (context) {
                const label = context.label || "";
                const value = context.raw || 0;
                const total = compliant + partiallyCompliant + nonCompliant;
                const percent = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                return `${label}: ${value} (${percent}%)`;
              },
            },
          },
        },
      },
    });
  } catch (error) {
    console.error("Error loading compliance distribution:", error);
  }
}

document.addEventListener("DOMContentLoaded", loadComplianceDistribution);
</script>


  <!-- end::GXON Page Scripts -->
</body>

</html>