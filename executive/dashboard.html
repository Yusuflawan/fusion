<!DOCTYPE html>
<html lang="en">

<head>
  <!-- begin::GXON Meta Basic -->
  <meta charset="utf-8" />

  <link rel="icon" type="image/png" href="assets/images/logo.jpeg" />
  <title>fusion HR Management Admin Dashboard</title>
  <!-- end::GXON Website Page Title -->

  <!-- begin::GXON Mobile Specific -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- end::GXON Mobile Specific -->

  <link rel="apple-touch-icon" sizes="180x180" href="assets/images/logo.jpeg" />
  <!-- end::GXON Favicon Tags -->

  <!-- begin::GXON Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
    rel="stylesheet" />
  <!-- end::GXON Google Fonts -->

  <!-- begin::GXON Required Stylesheet -->
  <link rel="stylesheet" href="assets/libs/flaticon/css/all/all.css" />
  <link rel="stylesheet" href="assets/libs/lucide/lucide.css" />
  <link rel="stylesheet" href="assets/libs/fontawesome/css/all.min.css" />
  <link rel="stylesheet" href="assets/libs/simplebar/simplebar.css" />
  <link rel="stylesheet" href="assets/libs/node-waves/waves.css" />
  <link rel="stylesheet" href="assets/libs/bootstrap-select/css/bootstrap-select.min.css" />
  <!-- end::GXON Required Stylesheet -->

  <!-- begin::GXON CSS Stylesheet -->
  <link rel="stylesheet" href="assets/libs/flatpickr/flatpickr.min.css" />
  <link rel="stylesheet" href="assets/libs/datatables/datatables.min.css" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <!-- Bootstrap core CSS (already in your project) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Add this line for Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- end::GXON CSS Stylesheet -->

  <!-- begin::GXON Googletagmanager -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XWVQM68HHQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-XWVQM68HHQ", {
      cookie_flags: "SameSite=None;Secure",
      send_page_view: true,
    });
  </script>
  <!-- end::GXON Googletagmanager -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
  <div class="page-layout">
    <!-- begin::GXON Page Header -->
    <header class="app-header">
      <div class="app-header-inner" id="header"></div>
    </header>
    <!-- end::GXON Page Header -->

    <div class="modal fade" id="searchResultsModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header py-1 px-3">
            <form class="d-flex align-items-center position-relative w-100" action="index.html#">
              <button type="button" class="btn btn-sm border-0 position-absolute start-0 p-0 text-sm">
                <i class="fi fi-rr-search"></i>
              </button>
              <input type="text" class="form-control form-control-lg ps-4 border-0 shadow-none" id="searchInput"
                placeholder="Search anything's" />
            </form>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body pb-2" style="height: 300px" data-simplebar>
            <div id="recentlyResults">
              <span class="text-uppercase text-2xs fw-semibold text-muted d-block mb-2">Recently Searched:</span>
              <ul class="list-inline search-list">
                <li>
                  <a class="search-item" href="index.html">
                    <i class="fi fi-rr-apps"></i> Dashboard
                  </a>
                </li>
                <li>
                  <a class="search-item" href="chat.html">
                    <i class="fi fi-rr-comment"></i> Chat
                  </a>
                </li>
                <li>
                  <a class="search-item" href="calendar.html">
                    <i class="fi fi-rr-calendar"></i> Calendar
                  </a>
                </li>
                <li>
                  <a class="search-item" href="chart/apexchart.html">
                    <i class="fi fi-rr-chart-pie-alt"></i> Apexchart
                  </a>
                </li>
                <li>
                  <a class="search-item" href="pages/pricing.html">
                    <i class="fi fi-rr-file"></i> Pricing
                  </a>
                </li>
                <li>
                  <a class="search-item" href="email/inbox.html">
                    <i class="fi fi-rr-envelope"></i> Email
                  </a>
                </li>
              </ul>
            </div>
            <div id="searchContainer"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- begin::GXON Sidebar Menu -->
    <div class="app-menubar" id="sidebsr"></div>
    <!-- end::GXON Sidebar Menu -->

    <!-- begin::GXON Sidebar right -->
    <div class="app-sidebar-end">
    </div>
    <!-- end::GXON Sidebar right -->

    <main class="app-wrapper">
      <div class="container">
        <div class="app-page-head d-flex flex-wrap gap-3 align-items-center justify-content-between">
          <div class="clearfix">
            <h1 class="app-page-title">Dashboard</h1>
            <span>Strategic overview of Lagos State IGR performance</span>
          </div>
        </div>
        <!-- DASHBOARD LAYOUT -->
        <div class="container-fluid py-4">

          <!-- Top Metric Cards -->
          <div class="row g-4 mb-4">
            <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Total Revenue (MTD)</h6>
                    <!-- icon absolutely positioned -->
                    <i class="bi bi-currency-dollar fs-3 text-secondary position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark" id="total_revenue">2</div>
                  <div class="text-success small">+12.5% from last month</div>
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Active Merchants</h6>
                    <i class="bi bi-people fs-5 text-secondary  position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark" id="active_merchants">2</div>
                  <div class="text-success small">+8.2% new registrations</div>
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Compliance Rate</h6>
                    <i class="bi bi-bar-chart-line fs-5 text-secondary  position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark" id="compliance_rate">85.6%</div>
                  <div class="text-success small">+2.1% improvement</div>
                </div>
              </div>
            </div>

            <!-- <div class="col-md-3">
              <div class="card border-1 rounded-4">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="text-dark mb-3">Risk Alerts</h6>
                    <i
                      class="bi bi-exclamation-triangle fs-5 text-secondary  position-absolute top-0 end-0 mt-3 me-3"></i>
                  </div>
                  <div class="fs-3 fw-bold text-dark">47</div>
                  <div class="text-danger small">+5 new this week</div>
                </div>
              </div> -->
            </div>
          </div>

          <!-- Revenue Trend & Compliance Distribution -->
          <div class="row g-3 mt-1">
            <div class="col-md-8">
              <div class="card p-3 h-100">
                <h6 class="fw-bold">Revenue Trend</h6>
                <p class="text-muted mb-2">Monthly IGR performance vs targets</p>
                <div class="chart-container">
                  <canvas id="revenueChart"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card p-3 h-100">
                <h6 class="fw-bold">Compliance Distribution</h6>
                <p class="text-muted mb-2">Merchant compliance status</p>
                <div class="chart-container">
                  <canvas id="complianceChart"></canvas>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="container mt-5">
          <div class="card rounded-3">
            <div class="card-body">
              <h5 class="fw-bold mb-1">Top Performing LGAs</h5>
              <p class="text-muted mb-4">Revenue and compliance by Local Government Area</p>

             <div class="table-responsive">
  <table class="table align-middle table-hover">
    <thead class="table-light">
      <tr>
        <th scope="col" class="ps-4">LGA</th>
        <th scope="col">Revenue (â‚¦)</th>
        <th scope="col">Compliance (%)</th>
        <th scope="col" class="pe-4">Status</th>
      </tr>
    </thead>
    <tbody id="lga-table-body">
    </tbody>
  </table>
</div>
          </div>
        </div>
      </div>


    </main>

    <!-- begin::GXON Footer -->
    <footer class="footer-wrapper bg-body">
      <div class="container">
        <div class="row g-2">
          <div class="col-lg-6 col-md-7 text-center text-md-start">
            <p class="mb-0">
              Â© <span class="currentYear">2025</span>. Proudly powered by
              <a href="javascript:void(0);">Binarifylimited</a>.
            </p>
          </div>
          <div class="col-lg-6 col-md-5">
            <ul class="d-flex list-inline mb-0 gap-3 flex-wrap justify-content-center justify-content-md-end">
              <li>
                <a class="text-body" href="index.html">Home</a>
              </li>
              <li>
                <a class="text-body" href="pages/faq.html">Faq's</a>
              </li>
              <li>
                <a class="text-body" href="pages/faq.html">Support</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <!-- end::GXON Footer -->
  </div>
  <!-- Load Chart.js once -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Loading Spinner -->
<div id="loading" style="text-align:center; padding:20px;">
  <div class="spinner" 
       style="width:40px; height:40px; border:4px solid #ddd; border-top:4px solid #007bff; border-radius:50%; animation: spin 1s linear infinite; margin:auto;">
  </div>
  <p>Loading charts...</p>
</div>

<!-- Chart Containers (hidden until data is ready) -->
<canvas id="revenueChart" style="display:none; max-height:300px;"></canvas>
<canvas id="complianceChart" style="display:none; max-height:300px;"></canvas>

<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>

<!-- Loading Spinner -->
<!-- <div id="loading" style="text-align:center; padding:20px;">
  <div class="spinner" 
       style="width:40px; height:40px; border:4px solid #ddd; border-top:4px solid #007bff; border-radius:50%; animation: spin 1s linear infinite; margin:auto;">
  </div>
  <p>Loading charts...</p>
</div> -->


<!-- <canvas id="revenueChart" style="display:none; max-height:300px;"></canvas>
<canvas id="complianceChart" style="display:none; max-height:300px;"></canvas> -->

<!-- <style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style> -->

<script>
  const apiUrl = "https://arafatfootballacademy.com/fusion/backend/executive/lga-performance"; 

  function getStatusBadge(compliance) {
    if (compliance === null) {
      return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-secondary bg-secondary-subtle">
                No Data
              </span>`;
    }

    const complianceRate = parseFloat(compliance);

    if (complianceRate >= 85) {
      return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-success bg-success-subtle">
                Excellent
              </span>`;
    } else if (complianceRate >= 70) {
      return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-warning bg-warning-subtle">
                Good
              </span>`;
    } else {
      return `<span class="badge rounded-pill px-3 py-2 fw-semibold text-danger bg-danger-subtle">
                Needs Attention
              </span>`;
    }
  }

  async function loadLgaData() {
    try {
      const response = await fetch(apiUrl);
      const result = await response.json();

      const tbody = document.getElementById("lga-table-body");
      tbody.innerHTML = "";

      result.data.forEach(item => {
        const compliance = item.compliant_rate
          ? parseFloat(item.compliant_rate)
          : null;

        const row = `
          <tr>
            <td class="ps-4">${item.lga_name}</td>
            <td>â‚¦${Number(item.transaction_volume).toLocaleString()}</td>
            <td>${compliance !== null ? compliance + "%" : "-"}</td>
            <td class="pe-4">
              ${getStatusBadge(compliance)}
            </td>
          </tr>
        `;

        tbody.insertAdjacentHTML("beforeend", row);
      });

    } catch (error) {
      console.error("Error fetching LGA data:", error);
    }
  }


  document.addEventListener("DOMContentLoaded", loadLgaData);

  document.addEventListener('DOMContentLoaded', async function () {
    const loadingEl = document.getElementById('loading');
    const revenueChartEl = document.getElementById('revenueChart');
    const complianceChartEl = document.getElementById('complianceChart');

    try {
      // Revenue API
      const revenueApi = 'https://arafatfootballacademy.com/fusion/backend/executive/revenue-trend'; 
      const revenueResponse = await axios.get(revenueApi);
      console.log(revenueResponse);
      const labels = revenueResponse.data.data.map(item => item.month_name);
      const revenues = revenueResponse.data.data.map(item => parseFloat(item.total_revenue));

      // Compliance API
      const complianceApi = 'https://arafatfootballacademy.com/fusion/backend/executive/marchants-pie-chart'; 
      const complianceResponse = await axios.get(complianceApi);
      const complianceData = complianceResponse.data.data;

      const total = complianceData.total_marchants || 1;
      const compliant = complianceData.compliant_marchants;
      const nonCompliant = complianceData.non_compliant_marchants;
      const partial = complianceData.partial_marchants;

      const compliantPct = ((compliant / total) * 100).toFixed(1);
      const partialPct = ((partial / total) * 100).toFixed(1);
      const nonCompliantPct = ((nonCompliant / total) * 100).toFixed(1);


      loadingEl.style.display = 'none';
      revenueChartEl.style.display = 'block';
      complianceChartEl.style.display = 'block';

      // Revenue Trend Chart
      new Chart(revenueChartEl, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Actual Revenue',
              data: revenues,
              borderColor: '#007bff',
              backgroundColor: 'transparent',
              tension: 0.3,
              pointRadius: 4
            },
          ]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      // Compliance Distribution Chart
      new Chart(complianceChartEl, {
        type: 'pie',
        data: {
          labels: [
            `Compliant ${compliantPct}%`,
            `Partial ${partialPct}%`,
            `Non-Compliant ${nonCompliantPct}%`
          ],
          datasets: [{
            data: [compliant, partial, nonCompliant],
            backgroundColor: ['#20c997', '#f6b93b', '#e74c3c']
          }]
        },
        options: {
          plugins: {
            legend: {
              display: true,
              position: 'right'
            }
          }
        }
      });

    } catch (error) {
      console.error("Error fetching data:", error);
      loadingEl.innerHTML = "<p style='color:red;'>Please try again.</p>";
    }
  });
</script>



  <!-- begin::GXON Page Scripts -->

  <script src="assets/js/header.js"></script>
  <script src="assets/js/logic/dashboard.js"></script>
  <!-- <script src="assets/libs/global/global.min.js"></script> -->
  <script src="assets/libs/sortable/Sortable.min.js"></script>
  <script src="assets/libs/chartjs/chart.js"></script>
  <script src="assets/libs/flatpickr/flatpickr.min.js"></script>
  <script src="assets/libs/apexcharts/apexcharts.min.js"></script>
  <script src="assets/libs/datatables/datatables.min.js"></script>
  <script src="assets/js/dashboard.js"></script>
  <script src="assets/js/todolist.js"></script>
  <script src="assets/js/appSettings.js"></script>
  <!-- <script src="assets/js/main.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


  <!-- end::GXON Page Scripts -->
</body>

</html>